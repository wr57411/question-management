# 背景和动机

本项目旨在为物理教师提供一个高效的题库管理工具，支持将日常做题通过Word或PDF文档批量归档到数据库，方便标注、粘贴答案（保留Word排版），支持图片答案（可裁剪），并能在手机和电脑APP端同步使用。初期无需登录注册，后续可扩展云服务和账户体系。

# 关键挑战和分析（更新）

- PDF文本结构复杂，题号、题干、图片等分割难度大，需结合正则、版面分析、人工规则等多策略。
- 题目识别需兼容多种排版风格，避免漏题、错题。
- 需每步开发后自主编写测试用例，确保识别效果。
- 需输出详细调试信息，便于定位问题。

# 高层任务拆分（PDF题目识别专项）

## 1. PDF文本与图片基础提取
- [x] 用PyMuPDF提取PDF文本和图片，预览展示（已完成）

## 2. PDF题目自动分割与识别
- [ ] 设计/优化正则表达式，结合question_rules.json，自动分割题号、题干、图片
- [ ] 针对常见物理题型（如"1."、"一、"等）编写多组规则，兼容不同排版
- [ ] 每次实现后，自动用典型PDF样例（如"提取题目_25测评卷电磁感应大题.pdf"）做自测，输出识别结果和调试日志
- [ ] 识别结果以表格形式展示，便于人工校验

## 3. 识别效果评估与人工修正
- [ ] 统计识别准确率、漏题、错题情况，输出调试报告
- [ ] 支持人工微调分割结果（如手动合并/拆分题目）

## 4. 代码结构与测试
- [ ] 题目识别逻辑单独封装，便于单元测试
- [ ] 每次改动后自动运行自测脚本，输出详细日志

# 成功标准（专项）
- 典型PDF样例能自动分割出90%以上题目，题号、题干、图片基本无错位
- 识别结果可人工快速校验和修正
- 每次提交均有自测报告和调试输出

# 经验教训和注意事项（补充）
- PDF结构复杂，需多策略结合，调试日志要详细
- 每步开发后都要用真实样例自测，不能只靠肉眼判断
- 识别规则要可配置、易扩展

# 关键挑战和分析

- PDF解析：现有仅支持Word，需兼容PDF的题目与图片提取。
- 答案富文本与图片混合：需保证答案粘贴后排版与Word一致，且支持图片上传、裁剪。
- 多端同步：需为APP端（优先移动端）设计API和数据结构，后端需支持RESTful接口，前端需考虑Flutter/React Native等跨平台方案。
- 无账户体系：数据同步需用本地唯一标识或扫码配对等方式，后续可扩展账户体系。
- 用户体验：题目标注、批量编辑、答案粘贴、图片裁剪等交互需流畅直观。
- 云服务迁移：需支持本地开发到云端部署的平滑迁移。

# 高层任务拆分

## 1. 支持PDF文档上传与题目识别
- [ ] 集成PDF解析库（如PyMuPDF、pdfplumber）
- [ ] 统一Word/PDF题目识别与图片提取逻辑
- [ ] 文档预览组件支持Word/PDF

## 2. 优化题目标注与答案粘贴
- [ ] 题目识别结果可手动调整、批量标注
- [ ] 答案粘贴支持Word富文本排版
- [ ] 答案区支持图片上传

## 3. 图片答案与裁剪功能
- [ ] 前端/APP端集成图片上传与裁剪（如Cropper.js、Flutter Image Cropper）
- [ ] 后端支持图片存储与关联

## 4. 多端同步与APP端开发
- [ ] 设计RESTful API，支持题目、答案、图片的增删查改
- [ ] 选型Flutter/React Native，开发APP端原型
- [ ] 实现本地与云端数据同步机制（如扫码配对）

## 5. 用户体验与批量操作
- [ ] 题目批量标注、批量编辑、批量上传
- [ ] 题目/答案预览优化

## 6. 测试与部署
- [ ] 单元测试、集成测试
- [ ] Docker化部署，支持本地和云端切换

# 云服务选型建议

- 开发初期：本地服务器+Docker，方便调试和快速迭代。
- 上线/多端同步：推荐Supabase（开源、免费额度大、支持Postgres、RESTful API、文件存储），或阿里云/腾讯云自建（需自己搭建API和数据库）。

# 迁移方案（本地→云端）

1. 本地开发阶段：后端API、数据库、文件存储均在本地。
2. 迁移到云端：数据库和文件迁移到云服务，API部署到云主机或Serverless平台。
3. 数据同步机制：采用RESTful API，所有端统一通过API读写数据。

# 后端API设计建议

- 题目管理：POST/GET/PUT/DELETE /api/questions/
- 文档上传与解析：POST /api/upload/word、/api/upload/pdf
- 答案管理：POST/GET/PUT /api/answers/
- 图片上传与裁剪：POST /api/images/、/api/images/crop
- 同步与备份：GET/POST /api/sync/
- 无账户体系下的同步：支持扫码配对或设备码方式

# 成功标准

- 支持Word和PDF文档上传，题目自动识别、可手动标注，支持图片题干和图片答案。
- 答案粘贴后排版与Word一致，支持图片上传与裁剪。
- 支持APP端（优先移动端）访问，数据可同步。
- 用户体验流畅，批量操作便捷。
- 无需登录注册，数据可本地或局域网同步。

# 经验教训和注意事项

- 题目、答案、图片等数据结构需统一，便于多端兼容。
- 富文本与图片混合存储建议用HTML或Markdown，数据库字段需支持长文本。
- 图片存储建议用云存储服务，避免数据库膨胀。
- API需设计好版本管理，便于后续升级。
- 本地开发时注意接口与云端兼容，迁移时减少改动。 